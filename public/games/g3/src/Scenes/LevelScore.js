import{colors}from"../Consts/Colors.js";import{generalImagesDataArr}from"../Consts/Values.js";import{gameData}from"../Consts/gameData.js";import{AudioManager}from"./manegers/Audiomanager.js";import{createElement}from"./../js/utils/createElements.js";import{fitTextContent}from"./../js/utils/fitTextContent.js";import AccessibilityManager from"./manegers/AccessibilityManager.js";class LevelScore{constructor(e,t,a,s,i,r,n){this.father=e,this.container=createElement("div","levelScore","levelScore"),this.userName=t[0].toUpperCase()+t.slice(1).toLowerCase(),this.userTime=a,this.userLevel=s,this.game=n,this.audioManager=new AudioManager(r,i),this.accessibilityManager=new AccessibilityManager,this.audioManager.playAudio(gameAssets.victory,1,!0),this.audioManager.playAudio(gameAssets.aplause,1,!0),this.createPainel(),gameData.class="LevelScore"}createPainel(){this.hideRulers();const e=createElement("div","scoreContainer","",{tabindex:"2","aria-label":"Placar"}),t=createElement("p","scoreHeader","",{tabindex:"3","aria-label":`Parabens ${this.userName} !`}),a=createElement("span","scoreTitle FIT","",{},`Parabéns ${this.userName}`),s=createElement("p","scoreBody","",{tabindex:"4"});s.style.background=gameData.isDarkMode?"none":colors.light_blue_9c;const i=createElement("div","scoreFooter");t.appendChild(a),e.append(t,s,i),this.container.appendChild(e),this.father.appendChild(this.container),fitTextContent(".scoreTitle"),this.buildBody(s),this.buildFooter(i)}hideRulers(){document.querySelectorAll(".ruler").forEach((e=>e.style.display="none"))}buildBody(e){const t=createElement("div","star1"),a=createElement("div","star2"),s=createElement("div","star3");let[i,r,n,o]=this.handleScore(this.userTime,this.userLevel);(gameData.isScreenReaderActive||gameData.isLibrasActive)&&(o=3),this.father.setAttribute("aria-label",`Você conseguiu ${o} estrelas`),t.appendChild(i),a.appendChild(r),s.appendChild(n),e.append(t,a,s)}buildFooter(e){const t=createElement("div","footerInfo");let a=this.game.gameDisplay.header.getTimer(),s=null,i=null;a>60&&(s=Math.floor(a/60),i=a%60);const r=createElement("p","levelInfo","",{tabindex:"5","aria-label":`na fase ${this.userLevel}`});r.innerHTML=`<span class="levelSpan">Level</span> <span class="levelNumber">${this.userLevel}</span>`;const n=createElement("p","timeInfo","",{tabindex:"6","aria-label":`em ${s?`${s} minuto ${i?`e ${i}`:""}`:a} segundos`});n.innerHTML=`<span>${this.userTime}s</span>`;const o=generalImagesDataArr.find((e=>"level"===e.name)),l=generalImagesDataArr.find((e=>"clock"===e.name)),c=createElement("img","levelImg","",{src:o.src,alt:o.description}),m=createElement("img","clockImg","",{src:l.src,alt:l.description});r.appendChild(c),n.appendChild(m),t.append(r,n),e.appendChild(t),this.buildFooterButtons(e)}buildFooterButtons(e){const t=createElement("div","btnsContainer"),a=createElement("button","btnReplay fa-solid fa-repeat","",{tabindex:7,title:"Jogar Novamente","aria-label":"Jogar Novamente"}),s=createElement("button","btnNext fa-solid fa-forward",{tabindex:"8",title:"Jogar próxima fase (indisponível no momento)","aria-label":"Jogar próxima fase (momentaneamente indisponível)"});t.append(a,s),e.appendChild(t),this.setFooterButtons(a,s,e)}setFooterButtons(e,t){let a="";if(!t||!e)throw new Error("Impossível configurar botões do score: parâmetros inexistentes");e.addEventListener("mouseover",(e=>{a!==e.target&&(gameData.isLibrasActive&&this.accessibilityManager.readWithAccessibility(`${e.target.title}`),setTimeout((()=>a=""),1e3))})),t.addEventListener("mouseover",(e=>{a!==e.target&&(gameData.isLibrasActive&&this.accessibilityManager.readWithAccessibility(`${e.target.title}`),setTimeout((()=>a=""),1e3))})),e.addEventListener("click",(e=>{const t=gameData.isScreenReaderActive||gameData.isLibrasActive;let a=t?4500:1e3;if(t){let e=3,t="começou";this.accessibilityManager.readText(`O jogo ${t}`,!1),this.accessibilityManager.readWithAccessibility(`O jogo ${t}`),setTimeout((()=>{let t=setInterval((()=>{e<=0||gameData.isLibrasActive?clearInterval(t):(1===e&&(this.audioManager.stopCurrentAudio(),this.audioManager.playAudio(gameAssets.transition)),this.accessibilityManager.readText(e,!1),this.accessibilityManager.readWithAccessibility(e),e--)}),1e3)}),500)}else this.audioManager.stopCurrentAudio(),this.audioManager.playAudio(gameAssets.transition);setTimeout((()=>{document.getElementById("gameBoard").style.display="grid",this.container.style.display="none",this.game.gameDisplay.body.reset(),this.game.replayGame()}),a)})),t.addEventListener("click",(()=>{this.popUpMessage("A fase 2 está momentaneamente indisponível. Aguarde as próximas atualizações",".btnReplay",6e3),this.userLevel<gameData.lastLevel&&this.game.user.updateUser()}))}popUpMessage(e,t,a=2500,s=!0,i=!1){const r=document.getElementById("popUp"),n=document.querySelector(".popupText"),o=document.querySelector(t);"flex"!=r.style.display&&(r.style.display="flex"),s&&(r.style.opacity=1),i||(n.textContent=""),n.setAttribute("tabindex",1),n.textContent=e,n.focus(),s&&setTimeout((()=>{r.style.opacity=0,r.style.display="none"}),a-1e3),t&&gameData.isScreenReaderActive&&setTimeout((()=>o.focus()),a+100)}handleScore(e,t){const a=e,s=100-10*Number(t);let i=createElement("img"),r=createElement("img"),n=createElement("img"),o=generalImagesDataArr.find((e=>"golden star"===e.name)).src,l=generalImagesDataArr.find((e=>"steel star"===e.name)).src;let c=function(e,t,a){return e<=t?3:e<=t+10?2:e<=a?1:0}(a,s,100);return gameData.isScreenReaderActive||gameData.isLibrasActive?(i.src=o,r.src=o,n.src=o,c=3,[i,r,n,c]):(i.src=c>=1?o:l,r.src=c>=2?o:l,n.src=c>=3?o:l,[i,r,n,c])}getImage(e){return gameAssets[e]}destroyScore(){this.container.style.display="none",this.father.remove(this.container)}}export{LevelScore};