import{IntroForm}from"../Scenes/Form.js";import{cardsImagesDataArr,audioDataArr}from"../Consts/Values.js";import{colors}from"../Consts/Colors.js";import{getDeviceSize}from"../js/utils/getDeviceSize.js";import{gameData}from"../Consts/gameData.js";class Preloader{constructor(){this.phaserGame=null,this.assetsControls={},this.setPreloader()}setPreloader(){const e=this;let[a]=getDeviceSize();const o=document.querySelector("#gameBoard"),s={type:Phaser.AUTO,width:a,height:a,backgroundColor:gameData.isDarkMode?colors.black:colors.blue_baby,parent:o,scene:{preload:function(){e.preload(this)}}};this.phaserGame=new Phaser.Game(s)}preload(e){const a=e.sys.game.canvas;let[o]=getDeviceSize(),s=o;this.setupCanvas(a);let t=window.gameAssets={};this.loadAssets(e);const r=document.querySelector(".logo"),l=e.add.graphics(),i=e.add.graphics(),d=this.setupLoadingUI(r,i,s,e);e.load.on("progress",(e=>{this.updateProgressBar(l,s,e)})),e.load.on("complete",(()=>{this.finalizePreload({store:t,logoImg:r,gameCanvas:a,progressBar:l,progressBox:i,loadingText:d,scene:e})}))}setupCanvas(e){e.id="tesourosHistoricos_canvas",e.parentNode.style.display="flex",e.style.border=`5px solid ${colors.blue_baby}`,e.style.borderRadius="20px"}loadAssets(e){cardsImagesDataArr.forEach((a=>{e.load.image(`${a.name}_1`,a.src),e.load.image(`${a.name}_2`,a.src)})),audioDataArr.forEach((a=>{e.load.audio(a.name,a.src)}))}setupLoadingUI(e,a,o,s){e.classList.add("active"),e.style.height=.65*o+"px",a.fillStyle("0xffffff",1),a.fillRoundedRect((o-.8*o)/2,.85*o,.8*o,20,15),a.lineStyle(5,"0xffffff",1),a.strokeRoundedRect((o-.8*o)/2,.85*o,.8*o,20,15);const t=s.make.text({x:o/2,y:.8*o,text:"Loading...",style:{font:"20px monospace",fill:"#ffffff"}});return t.setOrigin(.5,.5),t}updateProgressBar(e,a,o){e.clear(),e.fillStyle(3447003,1),e.fillRoundedRect((a-.8*a)/2+.01*a,.85*a+5,.78*a*o,10,5),e.setDepth(2)}finalizePreload({store:e,logoImg:a,gameCanvas:o,progressBar:s,progressBox:t,loadingText:r,scene:l}){gameData.isPreloadComplete=!0;const i=(e,a,o)=>{e[a]=o},d=e=>l.textures.get(e).getSourceImage();document.querySelector(".textToReader").textContent="O jogo foi carregado com sucesso.",audioDataArr.forEach((a=>{var o;i(e,a.name,(o=a.name,l.cache.audio.get(o)))})),cardsImagesDataArr.forEach((a=>{i(e,`${a.name}_1`,d(`${a.name}_1`)),i(e,`${a.name}_2`,d(`${a.name}_2`))})),setTimeout((()=>{["gameControls","gameBoard_aside","game_Container"].forEach((e=>{document.getElementById(e).style.display="flex",document.getElementById(e).style.display="flex",document.getElementById(e).style.display="flex"})),s.destroy(),t.destroy(),r.destroy(),o.remove(),a.classList.remove("actvive"),a.remove(),gameData.intro=new IntroForm}),500)}}export{Preloader};