import{User}from"../Class/User.js";import{LevelScore}from"./LevelScore.js";import{BoardRender}from"./manegers/BoardRender.js";import{AccessibilityManager}from"./manegers/AccessibilityManager.js";import{AudioManager}from"./manegers/Audiomanager.js";import{gameData}from"../Consts/gameData.js";import{fitTextContent}from"../js/utils/fitTextContent.js";class MemoryGame{constructor(e,s,i,a,t){this.mainContainer=document.querySelector("#game_Container"),this.size=e,this.user=new User(s),this.board=new BoardRender("#gameBoard",this.onCardClick.bind(this),this.user,e,this),this.audioContext=t,this.gainNode=a,this.accessibilityManager=new AccessibilityManager(".textToReader"),this.audioManager=new AudioManager(this.audioContext,this.gainNode),this.gameDisplay=i,this.flippedCards=[],this.isClickAble=!0,this.board.render(),this.user.updateUser(),this.gameDisplay.onMemoryGameConstruction(this.user),gameData.class="MemoryGame"}onCardClick(e,s){this.isClickAble&&this.flipCard(s,e)}flipCard(e){const s=this.board.cards[e];if(s.isFlipped||s.isMatched)return;s.flip(),this.flippedCards.push(s),this.audioManager.playAudio(gameAssets.select),this.board.updateBoard(e);const i=s.name.split("_")[0];this.gameDisplay.header.setCardsInfo(i,`${s.location.column}${s.location.row}`),this.gameDisplay.header.updateInfoContainer(),this.gameDisplay.body.updateDisplayImg(s.src,i,s.description),this.gameDisplay.footer.updateFooterText(s.description,fitTextContent),2===this.flippedCards.length?this.checkForMatch():(this.accessibilityManager.readText(`${i}.`),this.accessibilityManager.readWithAccessibility(`${i} ${s.location.column}${s.location.row}`))}checkForMatch(){const[e,s]=this.flippedCards,i=e.name.split("_")[0],a=s.name.split("_")[0];if(i===a)e.match(),s.match(),setTimeout((()=>this.audioManager.playAudio(gameAssets.success)),100),this.user.treasures++,this.gameDisplay.bar.updateBar(),this.user.treasures<this.size/2&&(this.accessibilityManager.readText(`${a}. Parabéns ${this.user.name} ! você Já tem ${this.user.treasures} tesouros. ${e.description}`),this.accessibilityManager.readWithAccessibility(`Parabéns ! Você coletou uma nova riquesa. ${e.description}`));else{const t=1e3;this.temporarilyDisableClick(t),e.fail(),s.fail(),setTimeout((()=>this.audioManager.playAudio(gameAssets.fail)),100),setTimeout((()=>{e.fail(),s.fail(),e.flip(),s.flip(),this.flippedCards=[],this.board.updateBoard(),this.accessibilityManager.readText(`${a}. Não foi dessa vez`),this.accessibilityManager.readWithAccessibility(`Errado ! ${i} ${s.location.column}${s.location.row}`)}),t)}this.checkForVictory(),this.flippedCards=[],this.board.updateBoard()}checkForVictory(){if(this.user.treasures==this.size/2){let e=this.gameDisplay.header.getTimer(),s=null,i=null;e>60&&(s=Math.floor(e/60),i=e%60),this.audioManager.stopCurrentAudio(),document.getElementById("gameBoard").style.display="none",this.accessibilityManager.readText(`Parabéns ${this.user.name} ! você coletou todos os ${this.user.treasures} tesouros em ${s?`${s} minutos ${i?`e ${i}`:""}`:e} segundos ! por isso você ganhou 3 estrelas na fase ${this.user.level}`),this.accessibilityManager.readWithAccessibility(`Parabéns ${this.user.name} ! você coletou todos os ${this.user.treasures} tesouros em ${s?`${s} minutos ${i?`e ${i}`:""}`:e} segundos ! por isso você ganhou 3 estrelas na fase ${this.user.level}`),document.title=`Placar da fase ${this.user.level}`,this.board.removePauseBtn(),gameData.score=new LevelScore(this.mainContainer,this.user.name.split(" ")[0],this.gameDisplay.header.getTimer(),this.user.level,this.gainNode,this.audioContext,this),this.gameDisplay.handleWin()}}startGame(){this.gameDisplay.header.setCardsInfo("",""),this.gameDisplay.header.startClock(),this.gameDisplay.bar.updateBar(),this.gameDisplay.update(),setTimeout((()=>{this.audioManager.playAudio(gameAssets.main,.5,!0)}),1500)}replayGame(){this.user.replayUserGame(),this.board.resetBoard(),this.gameDisplay.footer.updateFooterText("Desenvolvido por Wesley Welisten",fitTextContent),this.audioManager.reloadManager(),this.startGame(),gameData.class="MemoryGame"}temporarilyDisableClick(e){this.isClickAble=!1,setTimeout((()=>{this.isClickAble=!0}),e)}}export{MemoryGame};