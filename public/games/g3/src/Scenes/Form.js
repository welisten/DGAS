import{MemoryGame}from"./Game.js";import{GameDisplay}from"../Class/GameDisplay.js";import{GameAcessibleDisplay}from"../Class/GameAccessible.js";import{colors}from"../Consts/Colors.js";import{gameData}from"../Consts/gameData.js";import{createElement}from"../js/utils/createElements.js";class IntroForm{constructor(){this.container=document.getElementById("introFormContainer"),this.gameDisplay=void 0,this.gameAcessibleDisplay=void 0,this.isActive=!1,this.audioContext=new(window.AudioContext||window.webkitAudioContext),this.ucarineSong=gameAssets.ucarine,this.transitionSong=gameAssets.transition,this.errorSong=gameAssets.incorrect,this.click=gameAssets.click,this.currentAudio=null,this.gainNode=this.audioContext.createGain(),this.init()}init(){document.getElementById("gameBoard").style.display="none",this.playAudio(this.ucarineSong,1,!0),this.createForm(),this.createAside(),this.setupMuteButton(),this.isActive=!0,gameData.class="IntroForm"}createForm(){const e=createElement("form","introForm"),t=createElement("p","formTitle","",{tabindex:"2","aria-label":"Olá, vamos começar digitando o seu nome"}),i=createElement("div","formBody"),a=createElement("label","nameLabel","",{for:"user_name",title:"Digite seu nome"},"Nome: "),o=createElement("input","nameInput","",{tabindex:"2",type:"text",name:"user_name",placeholder:"Digite seu nome",id:"user_name","aria-label":"Digite seu nome","aria-required":"true"}),s=createElement("button","startBtn","",{tabindex:"2","aria-label":"Iniciar"},"iniciar");i.append(a,o,s),e.append(t,i),this.container.appendChild(e),this.setupFormInteractions(o,a,s),this.typewriter("Olá ! Vamos começar digitando o seu nome.",t)}createAside(){const e=document.getElementById("gameBoard_aside");this.gameDisplay=new GameDisplay(e),this.gameAcessibleDisplay=new GameAcessibleDisplay(e)}setupMuteButton(){const e=document.querySelector(".mute_btn");e?.addEventListener("click",(()=>{this.gainNode.gain.value=gameData.isMute?0:1}))}setupFormInteractions(e,t,i){e.addEventListener("focus",(()=>{gameData.isLibrasActive||(t.style.transform="translateY(0)",t.style.color=colors.white)})),e.addEventListener("blur",(()=>{e.value||gameData.isLibrasActive||(t.style.transform="translateY(5.5vh)",t.style.color=colors.black)})),i.addEventListener("click",(t=>{t.preventDefault(),this.handleStartButton(e)}))}handleStartButton(e){if(!e.value)return void this.invalidNameFeedback();if(!gameData.isClickable)return;gameData.isClickable=!1,this.playAudio(this.click);const t=gameData.isScreenReaderActive||gameData.isLibrasActive?4500:1e3;gameData.isScreenReaderActive||gameData.isLibrasActive?this.countdownToStart():(this.stopCurrentAudio(),this.playAudio(this.transitionSong)),setTimeout((()=>{this.startGame(e.value)}),t)}invalidNameFeedback(){const e=document.querySelector("#popUp"),t=gameData.isLibrasActive?null:2500,i=gameData.isLibrasActive?null:".nameInput";e.style.display="flex",e.classList.add("animated"),setTimeout((()=>e.classList.remove("animated")),1e3),this.playAudio(this.errorSong),this.popUpMessage("Digite um nome válido",i,t,!0,!0)}countdownToStart(){let e=3;const t=gameData.isLibrasActive?"começou":"começa em";this.readText(`O jogo ${t}`,!1),setTimeout((()=>{const t=setInterval((()=>{e<=0?clearInterval(t):(1==e&&(this.stopCurrentAudio(),this.playAudio(this.transitionSong)),this.readText(e,!1),e--)}),1e3)}),500)}startGame(e){this.isActive=!1,this.container.style.display="none",document.querySelector("#popUp").style.opacity=0;const t=new MemoryGame(16,e,this.gameDisplay,this.gainNode,this.audioContext);gameData.isClickable=!0,t.startGame()}playAudio(e,t=1,i=!1){if(!e)return;const a=this.audioContext.createBufferSource();a.buffer=e,a.loop=i;let o=t;t=!0===gameData.isMute?0:o,this.gainNode.gain.value=t,a.connect(this.gainNode),this.gainNode.connect(this.audioContext.destination),a.start(),!0===i&&(this.currentAudio=a)}stopCurrentAudio(){this.currentAudio&&(this.currentAudio.stop(),this.currentAudio=null)}readText(e,t=!1){const i=document.querySelector(".textToReader"),a=document.querySelector(".popupText");i.textContent=t?`${a.textContent} ${e}`:`${e}`,(gameData.isLibrasActive||gameData.isScreenReaderActive)&&gameData.intro.gameAcessibleDisplay.readWithAccessibility(e)}popUpMessage(e,t,i=2500,a=!0,o=!1,s=!1){const n=document.getElementById("popUp"),r=document.querySelector(".popupText"),c=document.querySelector(t);"flex"!=n.style.display&&(n.style.display="flex"),a&&(n.style.opacity=1),s||(r.textContent=""),r.setAttribute("tabindex",1),r.textContent=e,r.focus(),gameData.isLibrasActive&&gameData.intro.gameAcessibleDisplay.readWithAccessibility(e),o||setTimeout((()=>{n.style.opacity=0,n.style.display="none"}),1500),t&&i&&setTimeout((()=>c.focus()),i+100)}typewriter(e,t){let i=0;setTimeout((function a(){if(i<e.length){t.textContent+=e.charAt(i);const o=[".","!","?",","].includes(e.charAt(i))?500:50;i++,setTimeout(a,o)}else if(gameData.isScreenReaderActive)return void document.querySelector(".formTitle").focus()}),2e3)}changeToAccessibility(){const e=document.querySelector(".formBody"),t=document.querySelector(".nameLabel"),i=document.querySelector(".nameInput"),a=e.classList.toggle("accessible");t.innerHTML=a?"Digite seu Nome:":"Nome:",i.placeholder=a?"Nome":"Digite seu Nome",t.style.transform=a?"translateY(0)":"translateY(5.5vh)",t.style.color=a?colors.white:colors.black,i.style.color=a?colors.white:colors.black}toggleLight(){const e=document.querySelector(".introForm");document.querySelector(".lightMode_btn").classList.contains("active")?(this.container.style.backgroundColor=colors.black,e.style.backgroundColor=colors.transparent_a23,e.style.boxShadow=`0 0 .5em ${colors.blue_serious_ac7}`):(this.container.style.backgroundColor=colors.white,e.style.backgroundColor=colors.blue_baby,e.style.boxShadow="none")}}export{IntroForm};