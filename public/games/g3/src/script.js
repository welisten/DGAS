import{Preloader}from"./Scenes/Preload.js";import{getDeviceSize}from"./js/utils/getDeviceSize.js";import{colors}from"./Consts/Colors.js";import{gameData}from"./Consts/gameData.js";import{loadEnviromentVariables}from"./Consts/Values.js";import"./Style/game3.css";import"./js/librasBeauty.js";updateGame3Colors(),loadEnviromentVariables().then((()=>new Preloader)).then((()=>{setLightModeSlider(updateGame3Colors),updateDarkModeSwitch()})),document.addEventListener("DOMContentLoaded",(()=>{const e=window.location.origin;try{const t=new vLibras.Widget(`${e}/app`);console.log("vlibras widget initialized",t)}catch(e){return void console.error("vlibras widget not initialized: ",e)}}));const accessibleContainer=document.querySelector(".gameAccessibleContainer"),mainContainers=document.querySelectorAll(".mainContainer"),allControlBtns=document.querySelectorAll(".controlBtn"),vwBtn=document.querySelector("[vw-access-button]"),vLibrasContainer=document.getElementById("vLibras_container");let[containerHeight]=getDeviceSize();mainContainers.forEach((e=>{e.style.width=`${containerHeight}px`,e.style.height=`${containerHeight}px`})),handlePopUp();const controlBtnsAndTheirClss=Array.from(allControlBtns).map((e=>[e,e.className.split(" ")[1]]));function handlePopUp(){const e=document.querySelector(".popup_close_btn");e?e.addEventListener("click",(()=>{e.parentNode.style.opacity=0})):console.error("Botão de fechamento do PopUp não encontrado.\nImpossível configurar")}function setControlsBtnsEvents(e){e.addEventListener("mouseenter",(()=>{e.classList.add("hovered")})),e.addEventListener("click",(t=>{t.preventDefault(),e.classList.remove("hovered")})),e.addEventListener("mouseleave",(()=>{e.classList.remove("hovered")})),e.addEventListener("mouseover",(e=>{gameData.lastBtnTarget!==e.target&&(gameData.isLibrasActive&&(gameData.intro.gameAcessibleDisplay.readWithAccessibility(`${e.target.title}`),gameData.lastBtnTarget=e.target),setTimeout((()=>gameData.lastBtnTarget=""),1e3))}))}function preventAccessibilityConflict(){return gameData.isLibrasActive&&gameData.isScreenReaderActive}function readText(e){let t=document.querySelector(".textToReader");t?(e===gameData.lastReadText&&(e+="."),gameData.lastReadText=e,setTimeout((()=>{t.textContent=e}),10)):console.error("Elemento '.textToReader' não encontrado. Leitura de textos não configurada.")}function announceMessageWithPopUp(e,t,o=2500,r=!0,a=!1){const s=document.getElementById("popUp"),i=document.querySelector(".popupText"),l=document.querySelector(t);if(!s||!i)return void console.error("Pop-up ou texto do pop-up não encontrados.\nPopup não configurado!");"flex"!==s.style.display&&(s.style.display="flex"),r&&(s.style.opacity=1),i.setAttribute("tabindex",-1),a?i.textContent+=e:i.textContent=e,i.focus(),gameData.isLibrasActive&&gameData.intro.gameAcessibleDisplay.readWithAccessibility(e),r&&o&&setTimeout((()=>{s.style.opacity=0,s.style.display="none"}),o),t&&gameData.isScreenReaderActive&&setTimeout((()=>l.focus()),o+100)}function handleOutline(){let e="";function t(t){t.target.style.outline="none",t.target.style.outlineOffset="none",t.target.style.borderRadius=e}gameData.isScreenReaderActive?(document.addEventListener("focus",(function(t){e=t.target.style.borderRadius,t.target.style.outline="5px solid #FFA500",t.target.style.outlineOffset="5px",t.target.style.borderRadius="0px"}),!0),document.addEventListener("blur",t,!0)):document.addEventListener("focus",t,!0)}function updateDarkModeSwitch(){const e=document.querySelector("input#slider");gameData.isDarkMode?e.setAttribute("checked",""):e.removeAttribute("checked")}function setLightModeSlider(e){const t=document.querySelector("input#slider");t.addEventListener("click",(()=>{let o=document.documentElement;t.checked?(gameData.isDarkMode=!0,localStorage.setItem("isDarkMode",JSON.stringify(gameData.isDarkMode)),o.style.setProperty("--letter--",colors.letter_l)):(gameData.isDarkMode=!1,localStorage.setItem("isDarkMode",JSON.stringify(gameData.isDarkMode)),o.style.setProperty("--letter--",colors.letter_d)),e&&e()}))}function updateGame3Colors(){const e=document.documentElement.style;gameData.isDarkMode?(e.setProperty("--bg--",colors.body_color_dark),e.setProperty("--form-bg--",colors.transparent_a23),e.setProperty("--form-boxShadow--",`0 0 .5em ${colors.blue_serious_ac7}`),e.setProperty("--form-border",`1px solid ${colors.formBorder_dark}`),e.setProperty("--formContainer-bg--",colors.black),e.setProperty("--gameDisplay-bg--",colors.black_a87),e.setProperty("--gameDisplay-border",`1px solid ${colors.blue_baby}`),e.setProperty("--line-borderBottom",`1px solid ${colors.white_ice_a9f}`),e.setProperty("--gameDisplayHeader-fontWeight","200"),e.setProperty("--gameDisplayHeader-color",colors.body_color_light),e.setProperty("--clock-border",`2px solid ${colors.white_a56}`),e.setProperty("--clock-bg",colors.body_color_dark),e.setProperty("--clock-color",colors.white_ice_a9f),e.setProperty("--headerBar-color",colors.body_color_light),e.setProperty("--accessContainer-bg",colors.transparent_a10),e.setProperty("--accessContainer-border",`1px solid ${colors.blue_baby}`),e.setProperty("--scoreBody-bg",colors.black),e.setProperty("--score-bg",colors.score_bg_dark),e.setProperty("--gameBoard-bg",colors.black),e.setProperty("--scoreInfo-color",colors.white),e.setProperty("--scoreBody-border",`1px solid ${colors.white_a56}`)):(e.setProperty("--bg--",colors.body_color_light),e.setProperty("--form-bg--",colors.blue_baby),e.setProperty("--form-boxShadow--","none"),e.setProperty("--form-border",`2px solid ${colors.blue_dark_theme}`),e.setProperty("--formContainer-bg--",colors.white),e.setProperty("--gameDisplay-bg--",colors.white),e.setProperty("--gameDisplay-border",`3px solid ${colors.blue_baby}`),e.setProperty("--line-borderBottom",`1px solid ${colors.blue_dark_theme}`),e.setProperty("--gameDisplayHeader-fontWeight","400"),e.setProperty("--gameDisplayHeader-color",colors.header_light_color),e.setProperty("--clock-border",`2px solid ${colors.blue_dark_theme}`),e.setProperty("--clock-bg",colors.blue_baby),e.setProperty("--clock-color",colors.header_light_color),e.setProperty("--headerBar-color",colors.header_light_color),e.setProperty("--accessContainer-bg",colors.white),e.setProperty("--accessContainer-border",`3px solid ${colors.blue_baby}`),e.setProperty("--scoreBody-bg",colors.light_blue_9c),e.setProperty("--score-bg",colors.white),e.setProperty("--gameBoard-bg",colors.white),e.setProperty("--scoreInfo-color",colors.scoreinfo_light),e.setProperty("--scoreBody-border",`1px solid ${colors.blue_baby_a80}`))}gameData.lastBtnTarget="",controlBtnsAndTheirClss.forEach((e=>{switch(setControlsBtnsEvents(e[0]),e[1]){case"mute_btn":e[0].addEventListener("click",(()=>{if(gameData.isMute=!gameData.isMute,e[0].classList.toggle("active"),gameData.isScreenReaderActive){readText(`O Som foi ${e[0].classList.contains("active")?"desativado":"ativado"} `)}const t=e[0].children[0];t.classList.toggle("fa-volume-xmark"),t.classList.toggle("fa-volume-high")}));break;case"libras_btn":if(!vwBtn)return console.error("O botão de acesso do vlibras não foi encontrado.\nNão foi possível ativar o vlibras."),void alert("Não foi possível ativar a acessibilidade em Libras\nVerifique o console para mais informações");e[0].addEventListener("click",(t=>{const o=document.querySelector("[vw]");preventAccessibilityConflict()?announceMessageWithPopUp("Infelizmente, não é possivel ativar 2 modos de acessibilidade ao mesmo tempo",null,6e3):(e[0].classList.add("active"),accessibleContainer.classList.add("active"),gameData.isLibrasActive?announceMessageWithPopUp("Vlibras ja está ativado, Aperte no Botão de sair do Vlibras para fechar a ferramenta",null,null):(gameData.isLibrasActive=!0,gameData.intro.isActive&&gameData.intro.changeToAccessibility(),setTimeout((()=>{o.style.display="block",o.style.opacity="1",vwBtn.click();let t=!1;const r=new MutationObserver(((r,a)=>{const s=document.querySelector(".vpw-header-btn-close");s&&(t=!0,s.addEventListener("click",(()=>{o.style.display="none !important",o.style.opacity="0",gameData.isLibrasActive=!1,e[0].classList.remove("active"),accessibleContainer.classList.remove("active"),gameData.intro.changeToAccessibility(),gameData.intro.gameDisplay.toggleDisplay(),gameData.intro.gameAcessibleDisplay.toggleDisplay()})),a.disconnect())}));r.observe(vLibrasContainer,{childList:!0,subtree:!0}),setTimeout((()=>{t||(r.disconnect(),announceMessageWithPopUp("O botão de fechar não foi carregado. Recarregue a pagina",null,6e3))}),15e3)}),1e3),gameData.intro.gameDisplay.toggleDisplay(),gameData.intro.gameAcessibleDisplay.toggleDisplay()))}));break;case"screenReader_btn":e[0].addEventListener("click",(()=>{if(preventAccessibilityConflict())return void announceMessageWithPopUp("Infelizmente, não é possivel ativar 2 modos de acessibilidade ao mesmo tempo",null,6e3);gameData.isScreenReaderActive=!gameData.isScreenReaderActive,readText(`O aprimoramento do leitor de tela foi ${gameData.isScreenReaderActive?"ativado":"desativado"}.\n Para jogar no modo acessível para pessoas com deficiência visual recomendamos mantê-lo ativo.`),e[0].classList.toggle("active"),handleOutline(),!gameData.isPaused&&gameData.isScreenReaderActive&&"MemoryGame"==gameData.class&&(document.querySelector("#gameControls").style.display="none")})),handleOutline()}}));export{updateGame3Colors};