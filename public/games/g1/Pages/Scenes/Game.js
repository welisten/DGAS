import{gameData}from"../../Constants/gameData.js";import{colors}from"../../Constants/Colors.js";import{Sights}from"./Sights.js";import{sightData}from"../../Constants/sightsData.js";class Game{constructor(){this.element=document.querySelector("#game_container"),this.element.classList.add("j4-hm"),this.events=[],this.sights=["cutia","apa","concordia"],this.currentAudio={default:{config:{startTime:0,pausedAt:0},audio:void 0}},this.auxAudioaAmt=0,this.audioContext=new(window.AudioContext||window.webkitAudioContext),this.frogTimer=void 0,this.isTimeToChangeInstruc=!1,document.title="Vamos Explorar Guapimirim!",gameData.mainScene="Game",this.setSettingsControllers(),this.start()}setSettingsControllers(){const e=document.querySelector("#muteBtn"),t=document.querySelector("#lightBtn"),i=document.querySelector("#infoBtn"),s=document.querySelector("#accessBtn"),a=document.querySelector("#t-close"),o=document.querySelector("#info"),n=document.querySelectorAll(".i-navBtn"),r=document.querySelectorAll(".i-body");!function(){gameData.isMute?e.children[0].setAttribute("class","fa-solid fa-volume-xmark"):e.children[0].setAttribute("class","fa-solid fa-volume-high");gameData.isDarkMode?t.children[0].setAttribute("class","fa-regular fa-sun"):t.children[0].setAttribute("class","fa-regular fa-moon")}(),e.addEventListener("click",(()=>{this.toggleVolume()})),t.addEventListener("click",(()=>{this.toggleLightMode()})),i.addEventListener("click",(()=>{const e=document.querySelector("#main"),t=document.querySelector("#j4-bg");let i,s,a,n;o.classList.contains("active")||(i=document.querySelector(".t-text"),s=document.querySelector(".sub-tex"),a=document.querySelector(".body-g"),n=document.querySelector(".body-p"),"Game"===gameData.mainScene?(n.classList.add("active"),a.classList.remove("active")):(n.classList.remove("active"),a.classList.add("active")),e.classList.toggle("blur"),t.classList.toggle("blur"),o.classList.toggle("active"),gameData.isAccess&&i.focus(),textFit(i))})),s.addEventListener("click",(()=>{s.classList.toggle("active"),gameData.isAccess=!gameData.isAccess,s.children[0].classList.toggle("fa-regular"),s.children[0].classList.toggle("fa-solid"),s.classList.contains("active")?this.readText("O modo acessível foi ativado"):this.readText("O modo acessível foi desativado")})),a.addEventListener("click",(()=>{let e=document.querySelector(".hm-b-title");gameData.isAccess&&(this.readText("seção de instruções fechada."),e&&setTimeout((()=>e.focus()),50));const t=document.querySelector("#main"),i=document.querySelector("#j4-bg"),s=document.querySelector("#info");t.classList.toggle("blur"),i.classList.toggle("blur"),s.classList.toggle("active")}));const c=e=>{let t,i,s,a;if(i=document.querySelector("#info"),t=document.querySelector(".hm-b-title"),s=document.querySelectorAll(".last_p"),a=Array.from(s).some((e=>e===document.activeElement)),i.classList.contains("active"))switch(e.key){case"Escape":gameData.isAccess&&(this.readText("seção de instruções fechada."),t&&setTimeout((()=>t.focus()),50));const i=document.querySelector("#main"),s=document.querySelector("#j4-bg"),o=document.querySelector("#info");i.classList.toggle("blur"),s.classList.toggle("blur"),o.classList.toggle("active");break;case"ArrowLeft":case"ArrowRight":if(gameData.isAccess)return;l(e);break;case"Tab":if(!a&&!this.isTimeToChangeInstruc)return;if(this.isTimeToChangeInstruc)return l(e),void(this.isTimeToChangeInstruc=!1);a&&(this.isTimeToChangeInstruc=!0)}},l=e=>{let t=document.querySelectorAll(".i-b0");r.forEach((e=>e.classList.toggle("active"))),gameData.isAccess&&t.forEach((e=>{"none"!==e.style.display&&e.focus()}))};n.forEach((e=>{e.addEventListener("click",(t=>l(e)))})),document.addEventListener("mouseup",(e=>(e=>{let t,i,s,a,o=document.querySelector("#info");if(!e||!o)throw new Error("Evento ou elemento não fornecido");o.classList.contains("active")&&(t=e.target,i=document.querySelector("#main"),s=document.querySelector("#j4-bg"),a=document.querySelector(".gameControls"),o.contains(t)||a.contains(t)||(i.classList.toggle("blur"),s.classList.toggle("blur"),o.classList.toggle("active")))})(e))),document.addEventListener("keyup",(e=>c(e)))}start(e=!1){this.buildContainer(),e||this.buildBg(),this.setContainersElms(),this.playAudio(gameAssets.frog_croaking,"frog_croaking",.1),this.readText("seja bem vindo ao Jogo 4",!1),setTimeout((()=>{this.playAudio(gameAssets.theme_main,"theme_main",.05,!0),this.frogTimer=setInterval((()=>this.playAudio(gameAssets.frog_croaking,"frog_croaking",.1)),6e3),gameData.isClickable=!0}),1e3)}buildContainer(){this.setMainContainer();const e=document.querySelector("#main"),t=this.createNewElement("div","hm-container container"),i=this.createNewElement("div","hm-c-title container"),s=this.createNewElement("p","h-t-text");s.innerHTML="Vamos Explorar",s.setAttribute("tabindex","17"),i.appendChild(s),t.appendChild(i);const a=this.createNewElement("div","hm-board"),o=this.createNewElement("div","hm-b-head"),n=this.createNewElement("p","hm-b-title");n.innerHTML="escolha o local",n.setAttribute("tabindex","18"),n.setAttribute("aria-live","polite"),o.appendChild(n);const r=this.createNewElement("div","hm-b-body");let c=19;for(let e in sightData){let t=this.createNewElement("div","hm-b-r"),i=this.createNewElement("button","hm-b-d btn");i.textContent=e,i.setAttribute("tabindex",c++),i.setAttribute("title",`Ponto Turístico: ${e.toUpperCase()}`),t.appendChild(i),r.appendChild(t)}a.append(o,r),t.appendChild(a),e.appendChild(t),textFit(s)}setContainersElms(){let e;document.querySelectorAll(".hm-b-d").forEach((t=>{t.addEventListener("click",(t=>{gameData.isClickable&&(gameData.isClickable=!1,e=t.target.textContent,this.stopCurrentAudio(),this.playAudio(gameAssets.car_acceleration),setTimeout((()=>{this.playAudio(gameAssets.car_horn),this.readText("chegamos em"),setTimeout((()=>{switch(e){case"concordia":this.resetContainerToNewScene(),new Sights(this,"concordia");break;case"apa":this.resetContainerToNewScene(),new Sights(this,"apa");break;case"cotia":this.resetContainerToNewScene(),new Sights(this,"cotia");break;default:console.log("fase inexistente")}}),500)}),1800))}))})),this.setBtns()}setMainContainer(){let e,t,i;this.element.classList.remove("inactive"),e=window.screen.width>2e3?.4*window.screen.width:window.screen.width>1500?.65*window.screen.width:.6*window.screen.width,t=.4*window.screen.width,i=.613*window.screen.height,this.element.style.width=`${e}px`,this.element.style.height=`${i}px`}resetContainerToNewScene(e=""){document.querySelector("#main").innerHTML=" ",this.element.className=e,this.currentAudio={},this.stopCurrentAudio(),this.events.forEach((e=>e.elem.removeEventListener(e.event,e.func)))}readText(e,t=!0){let i;i=document.querySelector(".textToReader"),gameData.lastAccText===e&&(e+="."),t?(i.setAttribute("aria-live","assertive"),i.textContent=`${e}`):(i.setAttribute("aria-live","polite"),i.textContent=`${e}`),gameData.lastAccText=e}playAudio(e,t=void 0,i=1,s=!1){const a=this.audioContext.createBufferSource(),o=this.audioContext.createGain();a.buffer=e,a.loop=s;let n=gameData.isAccess?1:i;const r=!0===gameData.isMute?0:n;return o.gain.value=r,a.connect(o),o.connect(this.audioContext.destination),!1===s?a.start():t in this.currentAudio?(a.start(0,this.currentAudio[t].config.startTime),this.currentAudio[t].audio=a):(a.start(0,0),this.currentAudio[t]={config:{startTime:0,pausedAt:void 0,gainNode:o,volume:n}},this.currentAudio[t].audio=a),{source:a,gainNode:o}}stopCurrentAudio(){for(let e in this.currentAudio){if(this.currentAudio[e].config.startTime=0,this.currentAudio[e].audio){let t=this.currentAudio[e].audio.context.currentTime;this.currentAudio[e].audio.stop(),this.currentAudio[e].config.pausedAt=t}this.frogTimer&&(clearInterval(this.frogTimer),this.frogTimer=void 0)}}toggleLightMode(){let e=document.getElementById("lightBtn");gameData.isDarkMode?(document.body.style.background=colors.bg_light,gameData.isAccess&&this.readText("Jogando no modo diurno")):(document.body.style.background=`${colors.bg_dark}`,gameData.isAccess&&this.readText("Jogando no modo noturno")),e.children[0].classList.toggle("fa-sun"),e.children[0].classList.toggle("fa-moon"),gameData.isDarkMode=!gameData.isDarkMode}toggleVolume(){for(let e in this.currentAudio){let t;this.currentAudio[e].config.gainNode&&(t=this.currentAudio[e].config.gainNode.gain.value,t=t>0?0:this.currentAudio[e].config.volume,this.currentAudio[e].config.gainNode.gain.value=t)}muteBtn.children[0].classList.toggle("fa-volume-xmark"),muteBtn.children[0].classList.toggle("fa-volume-high"),gameData.isMute=!gameData.isMute,gameData.isAccess&&(gameData.isMute?this.readText("Som do jogo desativado"):this.readText("Som do jogo ativado"))}getImage(e){return gameAssets[e]}createNewElement(e,t=void 0,i=void 0,s=void 0,a=null){const o=document.createElement(e);if(t){let e=t.split(" ");for(let t=0;t<e.length;t++)o.classList.add(e[t])}return i&&o.setAttribute("id",i),s&&o.setAttribute("src",s),a&&"string"==typeof a&&(o.textContent=a),o}popUpMessage(e,t=3500){gameData.isClickable=!1;const i=document.getElementById("popUpMessage"),s=document.querySelector(".popupText");this.playAudio(gameAssets.deny,"deny"),i.style.top="0",s.children[0].textContent=e,setTimeout((()=>{i.style.top="-33rem",setTimeout((()=>s.children[0].textContent=""),1e3),gameData.isClickable=!0}),t)}buildBg(){const e=document.querySelector("#j4-bg"),t=this.createNewElement("div","j4-bg-bg"),i=this.getImage("foreground");i.className="foreground svg",i.setAttribute("alt","floresta ilustrada");const s=this.getImage("monkey_left");s.className="m_l monkey",s.setAttribute("alt","macaco pendurado no cipó");const a=this.getImage("monkey_right");a.className="m_r monkey",a.setAttribute("alt","macaco pendurado no galho");const o=this.getImage("home_gif");o.className="homeGif",o.setAttribute("alt","página inicial");const n=this.createNewElement("button","btn bg-homeBtn","homeBtn");n.setAttribute("tabindex","22"),n.setAttribute("title","Página Inicial "),n.appendChild(o),n.addEventListener("click",(()=>{gameData.isClickable&&"Game"!==gameData.mainScene?(this.resetContainerToNewScene("j4-hm"),gameData.mainScene="Game",document.title=" Vamos Explorar Guapimirim!",t.style.backgroundImage="url('./../Assets/imgs/general/hm_background.png')",this.start(!0)):gameData.isAccess&&this.readText("Você já está na página Inicial")})),n.addEventListener("mouseenter",(()=>{this.playAudio(gameAssets.btn_select,"btn_select",.05)})),e.append(t,i,s,a,n)}toggleBgDisplay(){const e=document.querySelector("#j4-bg");let t=e.style.display;e.style.display="none"===t?"block":"none"}setBtns(e=document){let t=e.querySelectorAll(".btn"),i=!1;t.forEach((t=>{t.addEventListener("mouseenter",(()=>{i||(i=!i,e===document&&this.playAudio(gameAssets.btn_select,"btn_select",.05))})),t.addEventListener("mouseout",(()=>{i=!1}))}))}}export{Game};